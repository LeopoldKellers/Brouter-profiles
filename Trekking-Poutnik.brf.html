<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008040;
}
.sc3 {
	color: #800040;
}
.sc4 {
	color: #0000FF;
}
.sc5 {
	color: #800000;
}
.sc6 {
	font-weight: bold;
	color: #666600;
}
.sc8 {
	font-weight: bold;
	color: #800080;
}
.sc12 {
	color: #FF0080;
}
.sc14 {
	font-weight: bold;
	color: #400080;
}
.sc15 {
	font-weight: bold;
	color: #008040;
}
.sc24 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2"># Trekking-Poutnik profile, template for Trekking profile variants
# Template version 2.5.2  + no code chnage, Notepad++ folding comment blocks inserted
# See also https://github.com/poutnikl/Brouter-profiles/wiki
# and https://github.com/poutnikl/Trekking-Poutnik
#
# LEGEND
#
# Legend above is placeholder for generated comments of final profile
# See the profile bottom for changelogs and verbose *) comments
</span><span class="sc24">
</span><span class="sc2"># </span><span class="sc15">bstart</span><span class="sc2"> </span><span class="sc8">/global</span><span class="sc2">
</span><span class="sc0">---context</span><span class="sc12">:</span><span class="sc0">global</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">iswet</span><span class="sc24">                  </span><span class="sc3">0</span><span class="sc24"> </span><span class="sc2"># 0 as default, *) flag for weather conditions
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">consider_elevation</span><span class="sc24">     </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">consider_smoothness</span><span class="sc24">    </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">set_uphill_cost</span><span class="sc24">        </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">set_downhill_cost</span><span class="sc24">      </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">allow_steps</span><span class="sc24">            </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">allow_ferries</span><span class="sc24">          </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">allow_traffic_penalty</span><span class="sc24">  </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1 as default
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">turnInstructionMode</span><span class="sc24">  </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24">  </span><span class="sc2"># 0=none, 1=auto-choose, 2=locus-style, 3=osmand-style
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">cycleroutes_pref</span><span class="sc24">       </span><span class="sc3">0.2</span><span class="sc24"> </span><span class="sc2"># **) costfactor penalty for not being cycleroute
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">routelevel</span><span class="sc24">             </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc2"># *****)  default =2, 1-icn only, 2 +ncn, 3 +rcn, 4 all
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">MTB_factor</span><span class="sc24">             </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># default 0.0, see ****), see also https://github.com/poutnikl/Brouter-profiles/wiki/Trekking-MTB-Profiles---legend
</span><span class="sc24">                                    </span><span class="sc2"># major rework ! unified with granularity of smallpaved factor
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">smallpaved_factor</span><span class="sc24">      </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># default 0.0, if &lt;&gt; 0.0 then it penalizes/promotes mainroads and unpaved roads for positive/negative values.
</span><span class="sc24">                                    </span><span class="sc2"># reworked                                    
</span><span class="sc24">                                    
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">hills</span><span class="sc24">                  </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 1=default,                         0=trekking profile default,                1=try to avoid steep hills &gt;3.0%, 
</span><span class="sc24">                                  </span><span class="sc2"># 2=velomobile-like avoiding slopes, 3= simulates ascend/length time equiv.     4=valley mode
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">valley_nonflat_multiplier</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24">
                                  

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">use_proposed_cn</span><span class="sc24">        </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc2"># 0 as default, considers proposed cycle networks as unmarked but valid cycleroutes.
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">avoid_unsafe</span><span class="sc24">           </span><span class="sc3">0</span><span class="sc24"> </span><span class="sc2"># 0 as default, gives penalty to road without bike friendly status.
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">path_preference</span><span class="sc24">        </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># 0.0 as default, try 20.0 to penalize nonpath ways a/o paved ways
</span><span class="sc24">


</span><span class="sc2"># Internal parameters
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">uphillcostvalue</span><span class="sc24">        </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc3">70</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc3">80</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24"> </span><span class="sc3">60</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc3">150</span><span class="sc24">
                                </span><span class="sc3">0</span><span class="sc24"> 
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">uphillcutoffvalue</span><span class="sc24">      </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc3">3.0</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
                                </span><span class="sc3">1.5</span><span class="sc24"> 
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">downhillcutoffvalue</span><span class="sc24">    </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
                                </span><span class="sc3">1.5</span><span class="sc24"> 
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">downhillcostvalue</span><span class="sc24">      </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc3">60</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc3">80</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24">  </span><span class="sc3">0</span><span class="sc24">
                                </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc3">150</span><span class="sc24">
                                </span><span class="sc3">60</span><span class="sc24">  

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">validForBikes</span><span class="sc24">        </span><span class="sc3">1</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">positive_smallpaved_factor</span><span class="sc24">  </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">smallpaved_factor</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">greater</span><span class="sc24"> </span><span class="sc0">smallpaved_factor</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
         
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">abs_smallpaved_factor</span><span class="sc24">  </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">positive_smallpaved_factor</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc0">smallpaved_factor</span><span class="sc24"> 
         

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">MTB_hillcostfactor</span><span class="sc24">   </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-0.3333</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc3">-3.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc0">MTB_factor</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                  </span><span class="sc2"># for MTBfactor &lt;=0 is 0, for MTBfactor &gt;=3 is 1, otherwise 0.3333 * MTBfactor
</span><span class="sc24">                  </span><span class="sc2"># progressively decreases hillcosts to be 0.0 at MTB_factor = 3.0
</span><span class="sc24">                  </span><span class="sc2"># if MTB_factor = 1 , then downhillcost decreases e.g. from 60 to 40
</span><span class="sc24">                  
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">downhillcost</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">consider_elevation</span><span class="sc24"> </span><span class="sc0">set_downhill_cost</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">  </span><span class="sc4">then</span><span class="sc24"> 
        </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">MTB_hillcostfactor</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc0">downhillcostvalue</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">uphillcost</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">consider_elevation</span><span class="sc24"> </span><span class="sc0">set_uphill_cost</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">  </span><span class="sc4">then</span><span class="sc24">
        </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">MTB_hillcostfactor</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc0">uphillcostvalue</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">uphillcutoff</span><span class="sc24">    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">consider_elevation</span><span class="sc24"> </span><span class="sc0">set_uphill_cost</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">   </span><span class="sc4">then</span><span class="sc24">    </span><span class="sc0">uphillcutoffvalue</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">downhillcutoff</span><span class="sc24">  </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">consider_elevation</span><span class="sc24"> </span><span class="sc0">set_downhill_cost</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc0">downhillcutoffvalue</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24"> 

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">elevationpenaltybuffer</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">10</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">5</span><span class="sc24">   </span><span class="sc2"># 5 is trekking default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">elevationmaxbuffer</span><span class="sc24">     </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">20</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">10</span><span class="sc24">  </span><span class="sc2"># 10 is trekking default
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">elevationbufferreduce</span><span class="sc24">  </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">0.333</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">uphillcutoff</span><span class="sc24"> </span><span class="sc0">downhillcutoff</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc2"># 0.0 is trekking default
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">uphillCFshift</span><span class="sc24">     </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># experimental shifting of up/downhillcostfactors as alternative way of 
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">downhillCFshift</span><span class="sc24">   </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># prioritizing/penalizing of up/downhills, based on length, not elevation
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">    </span><span class="sc0">network_coef</span><span class="sc24">           </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">  </span><span class="sc2"># 1 - cycleroutes_pref
</span><span class="sc4">assign</span><span class="sc24">    </span><span class="sc0">no_network_coef</span><span class="sc24">        </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24">                    </span><span class="sc2"># 1 + cycleroutes_pref
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">    </span><span class="sc0">pass1coefficient</span><span class="sc24"> </span><span class="sc3">1.8</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">    </span><span class="sc0">pass2coefficient</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">unsafe_penalty</span><span class="sc24">       </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc2"># 1 - was 2 in Trekking, but this may cause U-like safe routes
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">cost_of_unknown</span><span class="sc24">      </span><span class="sc3">2.0</span><span class="sc24"> </span><span class="sc2"># 2 as default, cost of highway=
</span><span class="sc24">
</span><span class="sc2"># </span><span class="sc15">bend</span><span class="sc2"> </span><span class="sc8">/global</span><span class="sc2">
# </span><span class="sc15">bstart</span><span class="sc2"> </span><span class="sc8">/way</span><span class="sc2">
</span><span class="sc0">---context</span><span class="sc12">:</span><span class="sc0">way</span><span class="sc24">   </span><span class="sc2"># following code refers to way-tags
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isicn</span><span class="sc24"> </span><span class="sc5">route_bicycle_icn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isncn</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_ncn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc0">ncn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> 
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isrcn</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_rcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc0">rcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">islcn</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_lcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc0">lcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> 

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">any_cycleroute</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_icn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_ncn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">route_bicycle_rcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc5">route_bicycle_lcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">any_cn_yes</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">lcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">rcn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc0">ncn</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">any_cn_proposed</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">lcn</span><span class="sc12">=</span><span class="sc6">proposed</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">rcn</span><span class="sc12">=</span><span class="sc6">proposed</span><span class="sc24"> </span><span class="sc0">ncn</span><span class="sc12">=</span><span class="sc6">proposed</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">any_cn</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">any_cn_yes</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">use_proposed_cn</span><span class="sc24"> </span><span class="sc0">any_cn_proposed</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">any_cycleroute</span><span class="sc24"> </span><span class="sc0">any_cn</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">is_ldcr</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc24">         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">false</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">false</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">routelevel</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">isicn</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">routelevel</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">isicn</span><span class="sc24"> </span><span class="sc0">isncn</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">routelevel</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">isrcn</span><span class="sc24"> </span><span class="sc0">isncn</span><span class="sc24"> </span><span class="sc0">isicn</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">routelevel</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">any_cn</span><span class="sc24">
               </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">isicn</span><span class="sc24"> </span><span class="sc0">isncn</span><span class="sc24">
                     

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc12">|</span><span class="sc6">permissive</span><span class="sc12">|</span><span class="sc6">designated</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">paved</span><span class="sc12">|</span><span class="sc6">asphalt</span><span class="sc12">|</span><span class="sc6">concrete</span><span class="sc12">|</span><span class="sc6">paving_stones</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">fine_gravel</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">cobblestone</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">probablyGood</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">  </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24">  </span><span class="sc2">#probably good surface - weather independent
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">  </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc12">|</span><span class="sc6">road</span><span class="sc12">|</span><span class="sc6">path</span><span class="sc12">|</span><span class="sc6">footway</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">ismainroad</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc12">|</span><span class="sc6">motorway_link</span><span class="sc12">|</span><span class="sc6">trunk</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc12">|</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc12">|</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc12">|</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24">  
               </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc24">   </span><span class="sc2"># ***)
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">turncost</span><span class="sc24">       </span><span class="sc4">if</span><span class="sc24">  </span><span class="sc0">ismainroad</span><span class="sc24">  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">90</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">60</span><span class="sc24">   </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">30</span><span class="sc24">
</span><span class="sc2"># Turn cost is based solely on estimation of road speediness and eventual time cost of turning, partially promoting tracks )
</span><span class="sc24">                      
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">initialclassifier</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">route</span><span class="sc12">=</span><span class="sc6">ferry</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc12">|</span><span class="sc6">motorway_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">trunk</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">             </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">5</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">6</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">unclassified</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">7</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">8</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">living_street</span><span class="sc24">  </span><span class="sc14">)</span><span class="sc24">               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">9</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">service</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">10</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">footway</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">11</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">12</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24">    </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">cycleway</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">13</span><span class="sc24">
                                                 </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">14</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">initialcost</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">route</span><span class="sc12">=</span><span class="sc6">ferry</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">10000</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc12">|</span><span class="sc6">motorway_link</span><span class="sc12">|</span><span class="sc6">trunk</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">500</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">120</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">80</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc12">|</span><span class="sc6">unclassified</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">50</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc12">|</span><span class="sc6">service</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">30</span><span class="sc24">
                                                            </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
  
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">access</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">motorroad</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">access</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">false</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">    
 
   
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">bikeaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
       </span><span class="sc14">(</span><span class="sc24">
         </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">vehicle</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">vehicle</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24">
       </span><span class="sc14">)</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc12">|</span><span class="sc6">dismount</span><span class="sc24">  

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">footaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">bikeaccess</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">dismount</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">foot</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">foot</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">accesspenalty</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">bikeaccess</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">footaccess</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">100000</span><span class="sc24">


</span><span class="sc2">#
# handle one-ways. On primary roads, wrong-oneways should
# be close to forbidden, while on other ways we just add
# 4 to the costfactor (making it at least 5 - you are allowed
# to push your bike)
#
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">badoneway</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">reversedirection</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
         </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc5">junction</span><span class="sc12">=</span><span class="sc6">roundabout</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc12">|</span><span class="sc6">true</span><span class="sc12">|</span><span class="sc3">1</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc3">-1</span><span class="sc24">
       

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">onewaypenalty</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc0">badoneway</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
       </span><span class="sc14">(</span><span class="sc24">
         </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">=</span><span class="sc0">opposite</span><span class="sc12">|</span><span class="sc0">opposite_lane</span><span class="sc12">|</span><span class="sc0">opposite_track</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">:</span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc24">                         </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24">              </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">50</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24">          </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">30</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24">            </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">20</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">4.0</span><span class="sc24">
       </span><span class="sc14">)</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">


</span><span class="sc2"># </span><span class="sc15">bstart</span><span class="sc2"> </span><span class="sc8">/roughness_penalty</span><span class="sc2">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">smoothness_penalty</span><span class="sc24">  
</span><span class="sc2"># http://wiki.openstreetmap.org/wiki/Key:smoothness
</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">consider_smoothness</span><span class="sc24">                                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc24">                                            </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">excellent</span><span class="sc12">|</span><span class="sc0">very_good</span><span class="sc12">|</span><span class="sc0">good</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">intermediate</span><span class="sc24">                                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">bad</span><span class="sc12">|</span><span class="sc0">robust_wheels</span><span class="sc24">                           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">very_bad</span><span class="sc12">|</span><span class="sc0">high_clearance</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">horrible</span><span class="sc12">|</span><span class="sc0">off_road_wheels</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">very_horrible</span><span class="sc24">                               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">smoothness</span><span class="sc12">=</span><span class="sc0">impassable</span><span class="sc24">                                  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">10.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc2"># </span><span class="sc15">bmid</span><span class="sc2"> </span><span class="sc8">/roughness_penalty</span><span class="sc2">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">mtb_scale_penalty</span><span class="sc24">  </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">consider_smoothness</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">

</span><span class="sc2"># Remember this is for trekking bikes, not MTB. There are MTB dedicated profiles.
# http://wiki.openstreetmap.org/wiki/Key:mtb:scale
</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc24">        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">0-</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc3">0</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">0+</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">1-</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.7</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">1+</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.8</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">2-</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2.5</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc3">2</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc0">2+</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">8.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc3">3</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">15.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24">   
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">mtb</span><span class="sc12">:</span><span class="sc0">scale</span><span class="sc12">=</span><span class="sc3">4</span><span class="sc12">|</span><span class="sc3">5</span><span class="sc12">|</span><span class="sc3">6</span><span class="sc24">   </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">9000</span><span class="sc24">
                     </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">roughness_penalty</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">smoothness_penalty</span><span class="sc24"> </span><span class="sc0">mtb_scale_penalty</span><span class="sc24">    
</span><span class="sc2"># </span><span class="sc15">bend</span><span class="sc2"> </span><span class="sc8">/roughness_penalty</span><span class="sc2">
</span><span class="sc24">   
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">univ_factor_coef</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
    
         </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc12">|</span><span class="sc6">motorway_link</span><span class="sc12">|</span><span class="sc6">trunk</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.9</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.7</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.4</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">unclassified</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">                            </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.25</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc12">|</span><span class="sc6">service</span><span class="sc12">|</span><span class="sc6">pedestrian</span><span class="sc12">|</span><span class="sc6">footway</span><span class="sc24">   </span><span class="sc14">)</span><span class="sc24">
                                                                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc3">0.25</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc12">|</span><span class="sc6">road</span><span class="sc12">|</span><span class="sc6">path</span><span class="sc24">                         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc3">0.25</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc2"># 
</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc12">|</span><span class="sc6">road</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">                           </span><span class="sc2"># not path
</span><span class="sc24">              </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">concrete</span><span class="sc24">                               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.2</span><span class="sc24">
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">0.33</span><span class="sc24"> </span><span class="sc0">roughness_penalty</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">cobblestone</span><span class="sc24">                        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">fine_gravel</span><span class="sc24">                   </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24">                              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade2</span><span class="sc12">|</span><span class="sc6">grade3</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24"> </span><span class="sc3">-0.7</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">compacted</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.5</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">grass</span><span class="sc24">                         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.8</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">ground</span><span class="sc12">|</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc12">|</span><span class="sc6">mud</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24">
                                                                </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24">
                </span><span class="sc14">)</span><span class="sc24">                                                  
         </span><span class="sc14">)</span><span class="sc24">   
         </span><span class="sc2"># is path
</span><span class="sc24">     </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">0.33</span><span class="sc24"> </span><span class="sc0">roughness_penalty</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                   </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">concrete</span><span class="sc24">                   </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.3</span><span class="sc24">
                     </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">                       </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">0.1</span><span class="sc24">
                     </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">compacted</span><span class="sc12">|</span><span class="sc6">fine_gravel</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.4</span><span class="sc24">
                     </span><span class="sc4">else</span><span class="sc24">                                       </span><span class="sc3">-1.0</span><span class="sc24">
                     </span><span class="sc14">)</span><span class="sc24">
          </span><span class="sc14">)</span><span class="sc24">           
                   
</span><span class="sc14">)</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">MTB_factor_for_road</span><span class="sc24">
   </span><span class="sc4">if</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">MTB_factor</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">  
                                </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">MTB_factor</span><span class="sc24">  </span><span class="sc0">univ_factor_coef</span><span class="sc24">
   
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">abs_univ_factor</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">  
    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">greater</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc0">univ_factor_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc0">univ_factor_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                                        </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc0">univ_factor_coef</span><span class="sc24">   
    
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">smallpaved_factor_for_road</span><span class="sc24">   

</span><span class="sc4">if</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">smallpaved_factor</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> 
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">abs_smallpaved_factor</span><span class="sc24"> 
              </span><span class="sc4">if</span><span class="sc24">  </span><span class="sc0">positive_smallpaved_factor</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">abs_univ_factor</span><span class="sc24">
                                             </span><span class="sc4">else</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc0">abs_univ_factor</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">trackclass_penalty</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24">        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">road</span><span class="sc24">        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">footway</span><span class="sc24">     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc6">footway</span><span class="sc12">=</span><span class="sc0">sidewalk</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                            </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc14">)</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">tracktype_penalty</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24">    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade2</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade3</span><span class="sc24">    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.6</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade4</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade5</span><span class="sc24">    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
</span><span class="sc14">)</span><span class="sc24">
 
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">surface_penalty</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">                                  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">asphalt</span><span class="sc12">|</span><span class="sc6">paved</span><span class="sc24">                   </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">concrete</span><span class="sc12">|</span><span class="sc6">paving_stones</span><span class="sc24">          </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">cobblestone</span><span class="sc12">|</span><span class="sc6">sett</span><span class="sc24">                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">compacted</span><span class="sc12">|</span><span class="sc6">fine_gravel</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24">                                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">ground</span><span class="sc12">|</span><span class="sc6">earth</span><span class="sc12">|</span><span class="sc6">unpaved</span><span class="sc12">|</span><span class="sc6">dirt</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">grass</span><span class="sc12">|</span><span class="sc6">sand</span><span class="sc24">                      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24">
                                                </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24">
</span><span class="sc14">)</span><span class="sc24">
                                           
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">not_isbike_track_penalty</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">  </span><span class="sc2"># this is track context </span><span class="sc8">/</span><span class="sc2"> isbike for mainroads is addressed elsewhere.// 2.2.1 ALFA
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24">          </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> 
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24">    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">4.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc24">                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">3.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade2</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.6</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade3</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade4</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade5</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">3.0</span><span class="sc24">
                                   </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">3.0</span><span class="sc24"> 

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">wet_penalty</span><span class="sc24">
</span><span class="sc4">if</span><span class="sc24">   </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24">                      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> 
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">compacted</span><span class="sc24">           </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.6</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">fine_gravel</span><span class="sc24">         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.8</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">cobblestone</span><span class="sc24">         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">grass</span><span class="sc24">               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">2.5</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24">
</span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">ground</span><span class="sc12">|</span><span class="sc6">earth</span><span class="sc12">|</span><span class="sc6">unpaved</span><span class="sc12">|</span><span class="sc6">sand</span><span class="sc12">|</span><span class="sc6">dirt</span><span class="sc12">|</span><span class="sc6">mud</span><span class="sc24">
                                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">3.5</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24">
                                    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc5">hascycleway</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24">
  </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc12">|</span><span class="sc0">none</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">:</span><span class="sc0">left</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">:</span><span class="sc0">left</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">:</span><span class="sc0">right</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc6">cycleway</span><span class="sc12">:</span><span class="sc0">right</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">trafficpenalty0</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
    </span><span class="sc14">(</span><span class="sc24">
      </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">4</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">5</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.4</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">6</span><span class="sc12">|</span><span class="sc3">7</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.6</span><span class="sc24"> 
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
    </span><span class="sc14">(</span><span class="sc24">
      </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">3</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">4</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.4</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">5</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.6</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">6</span><span class="sc12">|</span><span class="sc3">7</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
    </span><span class="sc14">(</span><span class="sc24">
      </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">2</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">3</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">4</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">estimated_traffic_class</span><span class="sc12">=</span><span class="sc3">5</span><span class="sc12">|</span><span class="sc3">6</span><span class="sc12">|</span><span class="sc3">7</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">1</span><span class="sc24">
      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">
    
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">trafficpenalty</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
  </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">hascycleway</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">min</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24"> </span><span class="sc0">trafficpenalty0</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc0">trafficpenalty0</span><span class="sc24">
  
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">nonpath_penalty</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
    </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">path_preference</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">   </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">                </span><span class="sc2"># nonpath_penalty inactive
</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">path_preference</span><span class="sc24">    </span><span class="sc2">#istrack = highway=track/path/road/footway
</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">                         </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">path_preference</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">or</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> 
                      </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc12">|</span><span class="sc6">grade2</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">path_preference</span><span class="sc24"> </span><span class="sc3">0.25</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24">
                  </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc24">
                  </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc12">|</span><span class="sc6">grade2</span><span class="sc24">
                  </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">cobblestone</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">  
                                            </span><span class="sc4">then</span><span class="sc24">                    </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">path_preference</span><span class="sc24"> </span><span class="sc3">0.125</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                                            </span><span class="sc4">else</span><span class="sc24">                    </span><span class="sc3">0.0</span><span class="sc24">
  
    </span><span class="sc14">)</span><span class="sc24">
                                             
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">rawcostfactor</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc2"># can be &lt;1, adjusted to &gt;=1 in final step of calculation of costfactor, uphillcostfactor,downhillcostfactor
</span><span class="sc24">  
  
  </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">onewaypenalty</span><span class="sc24"> </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">accesspenalty</span><span class="sc24">  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">allow_traffic_penalty</span><span class="sc24"> </span><span class="sc0">trafficpenalty</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">  
  
  </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc0">nonpath_penalty</span><span class="sc24">

  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">route</span><span class="sc12">=</span><span class="sc6">ferry</span><span class="sc24">  </span><span class="sc3">100000</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">steps</span><span class="sc24">  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">allow_steps</span><span class="sc24">   </span><span class="sc3">40</span><span class="sc24"> </span><span class="sc3">100000</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">route</span><span class="sc12">=</span><span class="sc6">ferry</span><span class="sc24">    </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">allow_ferries</span><span class="sc24"> </span><span class="sc3">5.67</span><span class="sc24"> </span><span class="sc3">100000</span><span class="sc24">
  
   
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">pedestrian</span><span class="sc24">                        </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc3">5</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">bridleway</span><span class="sc24">                         </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc3">8</span><span class="sc24"> </span><span class="sc3">5</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">cycleway</span><span class="sc24">                          </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc3">1.8</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc24">         </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc3">2.0</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc3">1.6</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24">    </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">service</span><span class="sc24">                           </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24"> </span><span class="sc3">1.8</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24"> </span><span class="sc3">1.1</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">

  </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">istrack</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">  </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">trackclass_penalty</span><span class="sc24">
                             </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">tracktype_penalty</span><span class="sc24">
                             </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">surface_penalty</span><span class="sc24">
                             </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">not_isbike_track_penalty</span><span class="sc24">
                             </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc0">roughness_penalty</span><span class="sc24">
                                 </span><span class="sc0">wet_penalty</span><span class="sc24">   
                  </span><span class="sc14">)</span><span class="sc24">
  
 </span><span class="sc4">else</span><span class="sc24">
   
</span><span class="sc2"># Penalty for unsafe roads. As wet fallback, it does not so strictly avoid unsafe
</span><span class="sc24">
  </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc0">avoid_unsafe</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">unsafe_penalty</span><span class="sc24">     </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">    </span><span class="sc3">0.5</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> 
                                         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">

  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc12">|</span><span class="sc6">motorway_link</span><span class="sc12">|</span><span class="sc6">proposed</span><span class="sc12">|</span><span class="sc6">abandoned</span><span class="sc12">|</span><span class="sc6">construction</span><span class="sc24">  </span><span class="sc3">100000</span><span class="sc24">
  
  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">trunk</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc24">          </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24"> </span><span class="sc3">1.8</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">5</span><span class="sc24"> </span><span class="sc3">10</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc24">      </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24"> </span><span class="sc3">1.5</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">2</span><span class="sc24"> </span><span class="sc3">3</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.1</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.4</span><span class="sc24"> </span><span class="sc3">1.6</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24">    </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc3">1.1</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.2</span><span class="sc24"> </span><span class="sc3">1.4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
  </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">unclassified</span><span class="sc24">              </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">isbike</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc4">switch</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc3">1.15</span><span class="sc24"> </span><span class="sc3">1.3</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
 
  </span><span class="sc0">cost_of_unknown</span><span class="sc24"> </span><span class="sc2"># above highway tags do not apply
</span><span class="sc24">  </span><span class="sc14">)</span><span class="sc24">
  
   
  </span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">                                        </span><span class="sc2"># MTB_factor_for_road + (non)/cycleroute CF adjustment
</span><span class="sc24">    </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">rawcostfactor</span><span class="sc24">                        </span><span class="sc2"># ignore cycleroutes, no distinguishing
</span><span class="sc24">    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc24">  </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">    </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">rawcostfactor</span><span class="sc24"> </span><span class="sc0">no_network_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                            </span><span class="sc14">(</span><span class="sc24">    </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc3">-1.0</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24"> </span><span class="sc0">network_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                        </span><span class="sc2"># is not a cycleroute
</span><span class="sc24">                        </span><span class="sc2"># rawcostfactor2 = rawcostfactor * no_network_coef - cycleroutes_pref * network_coef
</span><span class="sc24">                        </span><span class="sc2"># RCF2 = RCF * ( 1 + crp ) - crp * ( 1- crp )  
</span><span class="sc24">        </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">is_ldcr</span><span class="sc24">                       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">    </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">rawcostfactor</span><span class="sc24"> </span><span class="sc0">network_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
                            </span><span class="sc14">(</span><span class="sc24">    </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">cycleroutes_pref</span><span class="sc24"> </span><span class="sc0">network_coef</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> 
                        </span><span class="sc2"># is a considered cycleroute
</span><span class="sc24">                        </span><span class="sc2"># rawcostfactor2 = rawcostfactor * network_coef + cycleroutes_pref * network_coef
</span><span class="sc24">                        </span><span class="sc2"># RCF2 = RCF * ( 1 - crp ) + crp * ( 1- crp )  
</span><span class="sc24">    
    </span><span class="sc4">else</span><span class="sc24">                   </span><span class="sc0">rawcostfactor</span><span class="sc24">                        </span><span class="sc2"># is a cycleroute, but not a considered one
</span><span class="sc24">    </span><span class="sc14">)</span><span class="sc24">
    
    </span><span class="sc12">add</span><span class="sc24">   </span><span class="sc0">MTB_factor_for_road</span><span class="sc24">           </span><span class="sc2"># penalizes paved and promotes unpaved roads See *****) for more
</span><span class="sc24">          </span><span class="sc0">smallpaved_factor_for_road</span><span class="sc24">    </span><span class="sc2"># penalizes mainroads and unpaved roads, promotes the middle
</span><span class="sc24">    </span><span class="sc14">)</span><span class="sc24">  
            
  </span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">costfactor</span><span class="sc24">  </span><span class="sc2"># calculations may provide illegal costfactor &lt; 1
</span><span class="sc24">    </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24">
 
  
    
  </span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">uphillcostfactor</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">
    </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">  
    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24"> </span><span class="sc0">valley_nonflat_multiplier</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24">
    </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc0">uphillCFshift</span><span class="sc24">
    </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24"> 
    </span><span class="sc4">if</span><span class="sc24">   </span><span class="sc0">ismainroad</span><span class="sc24">                                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24"> 
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc24">       </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.1</span><span class="sc24"> 
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ispaved</span><span class="sc24">                                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.1</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24">                                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">   
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24">                               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">   
                                                    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">                          

  </span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">downhillcostfactor</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">  </span><span class="sc14">(</span><span class="sc24">
    </span><span class="sc12">max</span><span class="sc24"> </span><span class="sc3">1.0</span><span class="sc24">
    </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">hills</span><span class="sc24"> </span><span class="sc3">4</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24"> </span><span class="sc0">valley_nonflat_multiplier</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24">
    </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc0">downhillCFshift</span><span class="sc24">
    </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc0">rawcostfactor2</span><span class="sc24">
    </span><span class="sc4">if</span><span class="sc24">   </span><span class="sc0">ismainroad</span><span class="sc24">                                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.1</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24">  </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc24">      </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24">  </span><span class="sc0">ispaved</span><span class="sc24">                                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">-0.1</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">gravel</span><span class="sc12">|</span><span class="sc6">pebblestone</span><span class="sc24">              </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">fine_gravel</span><span class="sc12">|</span><span class="sc6">sand</span><span class="sc24">                </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.4</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">ismuddy</span><span class="sc24">                                 </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.5</span><span class="sc24">  
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade5</span><span class="sc24">                        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.4</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade4</span><span class="sc24">                        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">path</span><span class="sc12">|</span><span class="sc6">footway</span><span class="sc24">                    </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade3</span><span class="sc24">                        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">surface</span><span class="sc12">=</span><span class="sc6">cobblestone</span><span class="sc24">                     </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">iswet</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.3</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade2</span><span class="sc24">                        </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.1</span><span class="sc24">
    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">isunpaved</span><span class="sc24">                               </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0.2</span><span class="sc24">
                                                    </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0.0</span><span class="sc24">
    </span><span class="sc14">)</span><span class="sc24">
                                                   
</span><span class="sc2"># way priorities used for voice hint generation
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">priorityclassifier</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24">

  </span><span class="sc4">if</span><span class="sc24">      </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway</span><span class="sc24">                  </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">30</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway_link</span><span class="sc24">             </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">29</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">trunk</span><span class="sc24">                     </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">28</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">trunk_link</span><span class="sc24">                </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">27</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary</span><span class="sc24">                   </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">26</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">primary_link</span><span class="sc24">              </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">25</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary</span><span class="sc24">                 </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">24</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">secondary_link</span><span class="sc24">            </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">23</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary</span><span class="sc24">                  </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">22</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">tertiary_link</span><span class="sc24">             </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">21</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">unclassified</span><span class="sc24">              </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">20</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">16</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">service</span><span class="sc24">                   </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">14</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24">                  </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">6</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">cycleway</span><span class="sc24">                  </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">6</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">designated</span><span class="sc24">                </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">6</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">bridleway</span><span class="sc24">                 </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">4</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc12">|</span><span class="sc6">road</span><span class="sc12">|</span><span class="sc6">footway</span><span class="sc24">        </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">4</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">steps</span><span class="sc12">|</span><span class="sc6">path</span><span class="sc12">|</span><span class="sc6">pedestrian</span><span class="sc24">     </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">  </span><span class="sc3">2</span><span class="sc24">
  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
  </span><span class="sc14">)</span><span class="sc24">
                                                      
</span><span class="sc2"># some more classifying bits used for voice hint generation...
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isbadoneway</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc12">equal</span><span class="sc24"> </span><span class="sc0">onewaypenalty</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isgoodoneway</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">reversedirection</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc3">-1</span><span class="sc24">
                      </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc5">junction</span><span class="sc12">=</span><span class="sc6">roundabout</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc5">oneway</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc12">|</span><span class="sc6">true</span><span class="sc12">|</span><span class="sc3">1</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isroundabout</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc5">junction</span><span class="sc12">=</span><span class="sc6">roundabout</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">islinktype</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">motorway_link</span><span class="sc12">|</span><span class="sc6">trunk_link</span><span class="sc12">|</span><span class="sc6">primary_link</span><span class="sc12">|</span><span class="sc6">secondary_link</span><span class="sc12">|</span><span class="sc6">tertiary_link</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">isgoodforcars</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">greater</span><span class="sc24"> </span><span class="sc0">priorityclassifier</span><span class="sc24"> </span><span class="sc3">6</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">residential</span><span class="sc12">|</span><span class="sc6">living_street</span><span class="sc12">|</span><span class="sc6">service</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">track</span><span class="sc24"> </span><span class="sc5">tracktype</span><span class="sc12">=</span><span class="sc6">grade1</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
                  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc6">false</span><span class="sc24">

</span><span class="sc2"># ... encoded into a bitmask
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">classifiermask</span><span class="sc24"> </span><span class="sc12">add</span><span class="sc24">          </span><span class="sc0">isbadoneway</span><span class="sc24">
                      </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">isgoodoneway</span><span class="sc24">   </span><span class="sc3">2</span><span class="sc24">
                      </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">isroundabout</span><span class="sc24">   </span><span class="sc3">4</span><span class="sc24">
                      </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">islinktype</span><span class="sc24">     </span><span class="sc3">8</span><span class="sc24">
                          </span><span class="sc12">multiply</span><span class="sc24"> </span><span class="sc0">isgoodforcars</span><span class="sc24"> </span><span class="sc3">16</span><span class="sc24">
</span><span class="sc2"># </span><span class="sc15">bend</span><span class="sc2"> </span><span class="sc8">/way</span><span class="sc2">                          
# </span><span class="sc15">bstart</span><span class="sc2"> </span><span class="sc8">/node</span><span class="sc2">
</span><span class="sc0">---context</span><span class="sc12">:</span><span class="sc0">node</span><span class="sc24">  </span><span class="sc2"># following code refers to node tags
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24">   </span><span class="sc0">initial_cost_node</span><span class="sc24">    </span><span class="sc3">0</span><span class="sc24">     </span><span class="sc2"># 0 as default
</span><span class="sc24">
</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc0">access</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24"> </span><span class="sc2"># add default barrier restrictions here!
</span><span class="sc24">       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc0">access</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">false</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">bikeaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">nodeaccessgranted</span><span class="sc12">=</span><span class="sc6">yes</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24">
       </span><span class="sc14">(</span><span class="sc24">
         </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">vehicle</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24">
         </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">vehicle</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24">
       </span><span class="sc14">)</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc12">|</span><span class="sc6">dismount</span><span class="sc24">

</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">footaccess</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
       </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">dismount</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc6">true</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">foot</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc0">defaultaccess</span><span class="sc24">
       </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc12">not</span><span class="sc24"> </span><span class="sc5">foot</span><span class="sc12">=</span><span class="sc6">private</span><span class="sc12">|</span><span class="sc6">no</span><span class="sc24">


</span><span class="sc4">assign</span><span class="sc24"> </span><span class="sc0">initialcost</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24">
        </span><span class="sc12">add</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">traffic_signals</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">120</span><span class="sc24"> 
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">stop</span><span class="sc24">  </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">60</span><span class="sc24"> 
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">crossing</span><span class="sc24"> </span><span class="sc5">bicycle</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">60</span><span class="sc24"> 
              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc12">and</span><span class="sc24"> </span><span class="sc5">highway</span><span class="sc12">=</span><span class="sc6">crossing</span><span class="sc24"> </span><span class="sc6">crossing</span><span class="sc12">=</span><span class="sc6">no</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">300</span><span class="sc24"> </span><span class="sc2"># workaround affecting road routing
</span><span class="sc24">              </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc0">initial_cost_node</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">
            </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">bikeaccess</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">0</span><span class="sc24">  </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc14">(</span><span class="sc24"> </span><span class="sc4">if</span><span class="sc24"> </span><span class="sc0">footaccess</span><span class="sc24"> </span><span class="sc4">then</span><span class="sc24"> </span><span class="sc3">100</span><span class="sc24"> </span><span class="sc4">else</span><span class="sc24"> </span><span class="sc3">1000000</span><span class="sc24"> </span><span class="sc14">)</span><span class="sc24">

</span><span class="sc2"># </span><span class="sc15">bend</span><span class="sc2"> </span><span class="sc8">/node</span><span class="sc2">            
# </span><span class="sc15">bstart</span><span class="sc2"> </span><span class="sc8">/comments</span><span class="sc2">            
</span><span class="sc24">            
</span><span class="sc2">############################################################################################
#                                                                                          #
#                      V E R B O S E   L E G E N D S                                       #
#                                                                                          #
############################################################################################
# *) ISWET             iswet=0 is default with meaning of dry surfaces
############################################################################################
# iswet=1 with meaning surfaces are wet. It increases costfactors of potentially bad surfaces,
# especially those supposed to get muddy/slicky in wet weather, 
# OTOH it decreases costfactors for better quality tracks or highway network.
# It shifts the profile little toward fastbike standard profile, 
# but still focusses on trekking.
# 
#
############################################################################################
# **)  CYCLEROUTE PERFECTNESS - removed
# Cycleroutes have calculates their costfactors and turncosts by the same way as regular ways,
# Regular ways have additional penalty cycleroutes_pref for not being cycleroute. 
# 0.0 = ignore cycleroutes, 0.1-0.2 Prefering cycloroutes, &gt;0.6 similar as stick_to_cycleroutes
</span><span class="sc24">
</span><span class="sc2">############################################################################################
#
############################################################################################
# ***) ISMUDDY
############################################################################################
# ismuddy indicates potentially bad surface conditions during/after wet weather period( mud, slickness )
# Is used for increasing costfactor for such roads, and decreasing costfastor for minor highways/roads
# It requires iswet=1
#
#
#############################################################################################
# ****) MTB_factor
#############################################################################################
#
# MTB_factor tweaks/trims MTB approach of the profile  by preferring/penalizing in progressive order
# nonpaved  - preferred
# not paved - little preferred
# paved     - little penalized
# mainroads - penalized
#
# MTB_factor can be used for one-time tweaking of routing profile for particular trip,
# or trimming of the profile according to biker preferencing without need of profile deep insight
#
# Positive values progessively promote/penalize roads in favour of MTB riding.
</span><span class="sc24">
</span><span class="sc2"># Negative value has the opposite effect, preferring mainroads and penalizing unpaved roads.
# This effect is somewhat similar to iswet=1 ( *) wet weather mode ),
# but does not distinguish particular road classes </span><span class="sc8">/</span><span class="sc2"> surfaces </span><span class="sc8">/</span><span class="sc2"> smoothness,
# aside of mentioned schema below.
</span><span class="sc24">
</span><span class="sc2"># The calculated values below is added to the costfactor.
</span><span class="sc24">
</span><span class="sc2"># + MTB_factor                                    for main roads (tertiaries and better),
# + 0.33 * MTB_factor                             for paved roads,
# - 0.33 * MTB_factor                             for not paved/not unpaved roads,
# - MTB_factor * ( 1 + 0.33 * smoothnesspenalty ) for unpaved roads.  - at MTB_factor 3.0 smootheness is ignored
#
# Default   is 0.0 = no effect. 
# Recommended -0.5 - +1.0
# Reasonable  -2.0 .. +3.0, 
#
# Final costfactor is kept &gt;= 1 for final costfacto values.
#
#############################################################################################
# *****) routelevel
#############################################################################################
#
# global parameter routelevel determines what cyclenetwork levels are preferred by cycleroutes_pref
#            routelevel = 1  icn only
#            routelevel = 2  icn + ncn only
#            routelevel = 3  icn + ncn + rcn only
#            routelevel = 4  all icn + ncn + rcn + lcn, including sproposed ones, if use_proposed_cn=1
# Regardless of routelevel value,
# all current + proposed  networks are used in nodeaccessgranted and isbike 
#
#############################################################################################
# History log
#############################################################################################
# feature flags: + = new </span><span class="sc8">/</span><span class="sc2"> ! = fixed </span><span class="sc8">/</span><span class="sc2"> - = removed </span><span class="sc8">/</span><span class="sc2"> * = changed or improved
# Version 2.0.0 BETA - * organizing script without code changes
# Version 2.0.1 BETA - ! node initial cost logic (Mar 26 )
# Version 2.0.2 BETA - * partial syntax conversion (May 8 ), simplified uphill/downhill costs
# Version 2.1   BETA - * abandoned default compatibility with reference Trekking profile
# Version 2.1.1 BETA - + MTB_factor + up/downhillcostfactors
# Version 2.1.2 BETA - + 3state muddy/wet/dry track costfactors
# Version 2.1.3 BETA - + class-selective cycloroute usage
# Version 2.1.4 BETA - + smoothness penalty
# Version 2.1.5 RELEASE  - + hill profiles
# Version 2.1.6 BETA - + mtb:scale integrated to smoothness penalty
# Version 2.1.7 BETA - + smoothnesspenalty integrated to MTB factor, 
#                      * default routelevel=2 and cycleroutes_pref=0.1
# Version 2.1.8 BETA - * splitting smoothness penalty
# Version 2.1.9 ALFA - * Modified Cycleroute preference calculation - non cycleroutes, cycleroutes not considered, cycleroutes considered, 
# Version 2.1.10 ALFA - * increased smoothness penalties 
# Version 2.1.11 RELEASE- * modified MTB and smoothness penalties 
# Version 2.2.1 ALFA - * Track costfactors penalty driven now
# Version 2.2.2 ALFA - * highway=path penalty for downhill, * up/downhill costafactor , modified cycloroute preferencing 
# Version 2.2.3 ALFA - + initialclassifier + tweakeked track penalties
# Version 2.2.4 ALFA - + MTB factor affects hillcosts/cutoffs
# Version 2.2.5 ALFA - * synced with 2.1.14 RELEASE - but Track penalty systemor affects hillcosts/cutoffs
# Version 2.2.6 ALFA - * modified node initial cost, addressing some highway=crossing issues
# Version 2.2.7 ALFA - * Tweaked mainroad + residental costfactors
# Version 2.2.8 ALFA - * backporting to 2.1 Release
# Version 2.2.9 ALFA - * Rearranging global context
# Branch  2.3   ALFA - + Maximizing Track penalty system, instead of additive system of brach 2.2, 
#                      * partial penalty values changed, to follow different approach
# Version 2.3.1 ALFA - * Tweaked Track penalties, * tweaked Rougness penalties
# Version 2.3.2 ALFA - * Tweaked Track penalties, * rearranging general context code
# Version 2.3.3 ALFA - * Tweaked Cycleroute preferencing to nonlinear progressive penalizing
# Version 2.3.4 ALFA - ! fixed mean cutoff variable
#                      * Tweaked Cycleroute preferencing to nonlinear progressive penalizing
#                      * Switched MTB_factor vs cycleroute evaluation order
# Version 2.3.5 ALFA - * changed  elevationbufferreduce  = 0.333 * max (uphillcutoffvalue,downhillcutoffvalue)
# Version 2.3.6 ALFA - ! fix  elevationbufferreduce  placement and logic,  = 0.333 * max (uphillcutoff,downhillcutoff)
# Version 2.3.7 ALFA - -  Removed MTB_hillcutfactor, i.e. MTF factor affects hillcosts only.
# Version 2.4.1 ALFA - +  traffic penalty from fastbike low traffic profile
# Version 2.4.2 ALFA - +  smallpaved_factor
# Version 2.4.3 ALFA - *! smallpaved_factor rearranging and fixing error for negative values
# Version 2.4.4 ALFA - +  experimental up/downhillcostfactor shifts
# Version 2.4.5 ALFA - +  experimental small path only prioritization
# Version 2.4.6 ALFA - +  added priorityclassifier
# Version 2.4.7 ALFA - *  tweaked priorityclassifier value for footway and path
# Version 2.4.8 ALFA - +  assign   turnInstructionMode  = 2  # 0=none, 1=gpsies-style, 2=locus-style
# Version 2.4.9 BETA - *  updated  turnInstructionMode, code cleanup, release preparation
# Version 2.4.10 BETA - *  merged with recent trekking.brf changes
# Version 2.4.11 RELEASE - *  merged with release trekking.brf changes
# Version 2.4.12 BETA - + implemented valley mode ( assign hills 4 )
# Version 2.4.13 BETA - Fixed default hills value back to 1
# Version 2.4.14 ALFA -  * Switching MTB Factor granularity to smallpaved factor one - with keeping its effect, of course. Small Smoothness tweak
#                        * tweaked costfactors for cycleway/residential|living_street/service 
# Version 2.4.15 ALFA -  * Tweaked universal MTB/smallpaved factor coeficients
# Version 2.4.16 RELEASE * Updated trafficpenalty calculation from fastbike-lowtraffic
# Template version 2.5.1  * tweaked track costs
# </span><span class="sc15">bend</span><span class="sc2"> /comments</span></div></body>
</html>
